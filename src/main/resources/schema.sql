DROP TABLE genre IF EXISTS CASCADE;
DROP TABLE mpa IF EXISTS CASCADE;
DROP TABLE films IF EXISTS CASCADE;
DROP TABLE genres IF EXISTS;
DROP TABLE users IF EXISTS CASCADE;
DROP TABLE friendship_status IF EXISTS CASCADE;
DROP TABLE friends IF EXISTS;
DROP TABLE rate IF EXISTS;

CREATE TABLE IF NOT EXISTS genre(
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name varchar(40) NOT NULL CHECK (name IN ('Комедия','Драма','Мультфильм','Триллер','Документальный','Боевик'))
);

INSERT INTO genre (name) VALUES('Комедия');
INSERT INTO genre (name) VALUES('Драма');
INSERT INTO genre (name) VALUES('Мультфильм');
INSERT INTO genre (name) VALUES('Триллер');
INSERT INTO genre (name) VALUES('Документальный');
INSERT INTO genre (name) VALUES('Боевик');

CREATE TABLE IF NOT EXISTS mpa(
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name varchar(40) NOT NULL CHECK (name IN ('G','PG','PG-13','R','NC-17'))
);

INSERT INTO mpa (name) VALUES('G');
INSERT INTO mpa (name) VALUES('PG');
INSERT INTO mpa (name) VALUES('PG-13');
INSERT INTO mpa (name) VALUES('R');
INSERT INTO mpa (name) VALUES('NC-17');

CREATE TABLE IF NOT EXISTS films(
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name varchar(40) NOT NULL,
description varchar(200) NOT NULL,
release_date date NOT NULL CHECK (release_date > '1895-12-28'),
duration INTEGER NOT NULL CHECK (duration > 0),
rate INTEGER DEFAULT(0),
mpa_id INTEGER REFERENCES mpa(id)
);

CREATE TABLE IF NOT EXISTS genres(
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
film_id INTEGER REFERENCES films(id),
genre_id INTEGER REFERENCES genre(id)
);

CREATE TABLE IF NOT EXISTS users(
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name varchar(40) NOT NULL,
login varchar(40) NOT NULL CHECK(login <> ''),
email varchar(40) NOT NULL,
birthday date NOT NULL CHECK (birthday < CURRENT_DATE)
);

CREATE TABLE IF NOT EXISTS friendship_status(
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name BOOLEAN
);

INSERT INTO friendship_status (name)
VALUES('true'),
VALUES('false');

CREATE TABLE IF NOT EXISTS friends(
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
user_id INTEGER REFERENCES users(id),
status_id INTEGER REFERENCES friendship_status(id),
friend_id INTEGER REFERENCES users(id)
);

CREATE TABLE IF NOT EXISTS rate(
id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
film_id INTEGER REFERENCES films(id),
user_id INTEGER REFERENCES users(id)
);