DROP TABLE genre IF EXISTS CASCADE;
DROP TABLE mpa IF EXISTS CASCADE;
DROP TABLE films IF EXISTS CASCADE;
DROP TABLE genres IF EXISTS;
DROP TABLE users IF EXISTS CASCADE;
DROP TABLE friendship_status IF EXISTS CASCADE;
DROP TABLE friends IF EXISTS;
DROP TABLE rate IF EXISTS;

CREATE TABLE IF NOT EXISTS genre(
id LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name varchar(40) NOT NULL CHECK (name IN ('Комедия','Драма','Мультфильм','Триллер','Документальный','Боевик'))
);

CREATE TABLE IF NOT EXISTS mpa(
id LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name varchar(40) NOT NULL CHECK (name IN ('G','PG','PG-13','R','NC-17'))
);

CREATE TABLE IF NOT EXISTS films(
id LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name varchar(40) NOT NULL,
description varchar(200) NOT NULL,
release_date date NOT NULL CHECK (release_date > '1895-12-28'),
duration INTEGER NOT NULL CHECK (duration > 0),
rate INTEGER DEFAULT(0),
mpa_id LONG REFERENCES mpa(id)
);

CREATE TABLE IF NOT EXISTS genres(
id LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
film_id LONG REFERENCES films(id),
genre_id LONG REFERENCES genre(id)
);

CREATE TABLE IF NOT EXISTS users(
id LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
name varchar(40) NOT NULL,
login varchar(40) NOT NULL CHECK(login <> ''),
email varchar(40) NOT NULL,
birthday date NOT NULL CHECK (birthday < CURRENT_DATE)
);

CREATE TABLE IF NOT EXISTS friends(
id LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
user_id LONG REFERENCES users(id),
friend_id LONG REFERENCES users(id)
);

CREATE TABLE IF NOT EXISTS rate(
id LONG GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
film_id LONG REFERENCES films(id),
user_id LONG REFERENCES users(id)
);